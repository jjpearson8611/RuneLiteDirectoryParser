<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    
    <title>RuneLite Stat Grapher</title>
  </head>
  <body>
    <div id="NoData" class="container-fluid">
	<h1>Directions</h1>
		<p>Open powershell and cd to your runeline directory. Once in your runelite directory go to the desired account and to its screenshot folder. Once in this folder do the following command. <br/><samp>dir | clip</samp><br/> This will copy the contents of that folder to your clipboard. Now paste these contents into the website. All account details are client side only. There is no server side data being collected.</p> 		
		<div class="row">
			<div class="col">
				<textarea class="form-control" id="UserData" rows="15"></textarea> <br/>
				<input class="btn btn-primary" type="button" id="supplyData" value="Generate Line Graph">
			</div>
			<div class="col">
				<table class="table">
					<tr>
						<td><input type="checkbox" id="Attack"></input>Attack</td>
						<td><input type="checkbox" id="Hitpoints" >Hitpoints</td>
						<td><input type="checkbox" id="Mining">Mining</td>
					</tr>
					<tr>
						<td><input type="checkbox" id="Strength"></input>Strength</td>
						<td><input type="checkbox" id="Agility">Agility</td>
						<td><input type="checkbox" id="Smithing" >Smithing</td>
					</tr>
					<tr>
						<td><input type="checkbox" id="Defence" ></input>Defence</td>
						<td><input type="checkbox" id="Herblore" >Herblore</td>
						<td><input type="checkbox" id="Fishing" >Fishing</td>
					</tr>
					<tr>
						<td><input type="checkbox" id="Ranged" ></input>Ranged</td>
						<td><input type="checkbox" id="Thieving" >Thieving</td>
						<td><input type="checkbox" id="Cooking" >Cooking</td>
					</tr>
					<tr>
						<td><input type="checkbox" id="Prayer" ></input>Prayer</td>
						<td><input type="checkbox" id="Crafting" >Crafting</td>
						<td><input type="checkbox" id="Firemaking" >Firemaking</td>
					</tr>
					<tr>
						<td><input type="checkbox" id="Magic" ></input>Magic</td>
						<td><input type="checkbox" id="Fletching" >Fletching</td>
						<td><input type="checkbox" id="Woodcutting" >Woodcutting</td>
					</tr>
					<tr>
						<td><input type="checkbox" id="Runecraft"></input>Runecrafting</td>
						<td><input type="checkbox" id="Slayer" >Slayer</td>
						<td><input type="checkbox" id="Farming" >Farming</td>
					</tr>
					<tr>
						<td><input type="checkbox" id="Construction" ></input>Construction</td>
						<td><input type="checkbox" id="Hunter" >Hunter</td>
						<td>Total (Coming Soon)</td>
					</tr>
				</table>
				<input class="btn btn-primary" type="button" id="all" value="Select All (Warning Slow)">
				<input class="btn btn-primary" type="button" id="none" value="Select None">
				<input class="btn btn-primary" type="button" id="support" value="Support">
				<input class="btn btn-primary" type="button" id="artisan" value="Artisan">
				<input class="btn btn-primary" type="button" id="gathering" value="Gathering">
				<input class="btn btn-primary" type="button" id="combat" value="Combat">
				
				<div class="btn-group btn-group-toggle" data-toggle="buttons">
				  <label class="btn btn-secondary active">
					<input type="radio" name="options" id="level" checked> Use Level
				  </label>
				  <label class="btn btn-secondary">
					<input type="radio" name="options" id="xp"> Use XP (coming soon)
				  </label>
				</div>
			</div>
		</div>
	
	</div>
	<div id="WithData" class="container-fluid">
		<div>
			<div id="curve"> </div>
			<input class="btn btn-primary" type="button" id="revertData" value="Go Back">
		</div>
	
	</div>
	
    
	<script>
		
		var skills = [];
	
		function drawChart(rawData) {
			var data = google.visualization.arrayToDataTable(rawData);

			var options = {
				chart: {
				  title: 'Runescape Levels Over Time'
				},
				width: $(window).width() * .95,
				height: $(window).height() * .95
			  };


			var chart = new google.charts.Line(($('#curve')[0]));

			chart.draw(data, google.charts.Line.convertOptions(options));
		};
		
		function loadSkills()
		{
			//clear out array first
			skills = [];
			
			if($("#Attack").prop("checked"))
			{
				skills.push("Attack");
			}
			if($("#Strength").prop("checked"))
			{
				skills.push("Strength");
			}
			if($("#Defence").prop("checked"))
			{
				skills.push("Defence");
			}
			if($("#Ranged").prop("checked"))
			{
				skills.push("Ranged");
			}
			if($("#Prayer").prop("checked"))
			{
				skills.push("Prayer");
			}
			if($("#Magic").prop("checked"))
			{
				skills.push("Magic");
			}
			if($("#Runecraft").prop("checked"))
			{
				skills.push("Runecraft");
			}
			if($("#Hitpoints").prop("checked"))
			{
				skills.push("Hitpoints");
			}
			if($("#Crafting").prop("checked"))
			{
				skills.push("Crafting");
			}
			if($("#Mining").prop("checked"))
			{
				skills.push("Mining");
			}
			if($("#Smithing").prop("checked"))
			{
				skills.push("Smithing");
			}
			if($("#Fishing").prop("checked"))
			{
				skills.push("Fishing");
			}
			if($("#Cooking").prop("checked"))
			{
				skills.push("Cooking");
			}
			if($("#Firemaking").prop("checked"))
			{
				skills.push("Firemaking");
			}
			if($("#Woodcutting").prop("checked"))
			{
				skills.push("Woodcutting");
			}
			if($("#Agility").prop("checked"))
			{
				skills.push("Agility");
			}
			if($("#Herblore").prop("checked"))
			{
				skills.push("Herblore");
			}
			if($("#Thieving").prop("checked"))
			{
				skills.push("Thieving");
			}
			if($("#Fletching").prop("checked"))
			{
				skills.push("Fletching");
			}
			if($("#Slayer").prop("checked"))
			{
				skills.push("Slayer");
			}
			if($("#Farming").prop("checked"))
			{
				skills.push("Farming");
			}
			if($("#Construction").prop("checked"))
			{
				skills.push("Construction");
			}
			if($("#Hunter").prop("checked"))
			{
				skills.push("Hunter");
			}
			if(jQuery.isEmptyObject(skills))
			{
				skills.push("Runecraft");			
			}
			//for when we add total skill tracking
			//if($("#Total").prop("checked"))
			//{
			//	skills.push("Total");
			//}
		}
		function parseLine(incLine)
		{
			//try catch here is to ignore any errors
			try
			{
				var splitted = incLine.split(' ');
				var date = new Date(splitted[1] + " " + splitted[2]+ " " + splitted[3]);
				var skill = splitted[5].split("(")[0];
				var level = splitted[5].split("(")[1].split(")")[0];
				return [date, skill, level];
			}
			catch(err)
			{
				console.log(err);
			}			
		}
				
		//when fully loaded get charts ready and hide blank chart
		$( document ).ready(function() {
			google.charts.load('current', {'packages':['line']});
			$("#WithData").hide();
		});
		$( "#supplyData" ).click(function() {
			//Swap between views and clean up spaces in data
			$("#NoData").hide();
			$("#WithData").show();
			$('#UserData').val($('#UserData').val().replace(/ +(?= )/g,''));
			
			loadSkills();
			
			//Do some basic filtering for lines that only have selected skills and explicitly remove the quests
			var lines = $('#UserData').val().split('\n');
			var parsedData = "";
			var table = [];
			
			for(var i = 0; i < lines.length; i++)
			{
				if(new RegExp(skills.join("|")).test(lines[i]) && !lines[i].includes("Quest"))
				{
					parsedData = lines[i] + "\n" + parsedData;
					table.push(parseLine(lines[i]));
				}
			}			

			//sort the parsed lines based on timestamp
			table.sort(function(a,b) {
				return a[0] - b[0];		
			});
					
			//create first row for data headers and second row for initial account guess
			var graphableData = [];
			var firstRow = [];
			firstRow.push('Time');
			var secondRow = [];
			secondRow.push(new Date(table[0][0] - 6000000));
			for(var i = 0; i < skills.length; i++)
			{
				firstRow.push(skills[i]);
				if(skills[i] != 'Hitpoints')
				{
					secondRow.push(1);
				}
				else
				{
					secondRow.push(10);
				}
			}
			
			graphableData.push(firstRow);
			graphableData.push(secondRow);	
			
			//restructuring of data to fit into line chart
			for(var i = 0; i < table.length - 2;i++)
			{
				var skillIndex = jQuery.inArray(table[i][1], skills) + 1;
				var temp = graphableData[i + 1].slice();
				temp[skillIndex] = table[i][2];
				temp[0] = table[i][0];
				graphableData.push(temp);
			}
			
			
			google.charts.setOnLoadCallback(drawChart(graphableData));
			
		});
		
		//go from graphs back to data entry
		$( "#revertData" ).click(function() {
			$("#NoData").show();
			$("#WithData").hide();
		});
		
		function checkAll(OnorOff)
		{
			$("#Attack").prop("checked",OnorOff);
			$("#Hitpoints").prop("checked",OnorOff);
			$("#Mining").prop("checked",OnorOff);
			$("#Strength").prop("checked",OnorOff);
			$("#Agility").prop("checked",OnorOff);
			$("#Smithing").prop("checked",OnorOff);
			$("#Defence").prop("checked",OnorOff);
			$("#Herblore").prop("checked",OnorOff);
			$("#Fishing").prop("checked",OnorOff);
			$("#Ranged").prop("checked",OnorOff);
			$("#Thieving").prop("checked",OnorOff);
			$("#Cooking").prop("checked",OnorOff);
			$("#Prayer").prop("checked",OnorOff);
			$("#Crafting").prop("checked",OnorOff);
			$("#Firemaking").prop("checked",OnorOff);
			$("#Magic").prop("checked",OnorOff);
			$("#Fletching").prop("checked",OnorOff);
			$("#Woodcutting").prop("checked",OnorOff);
			$("#Runecraft").prop("checked",OnorOff);
			$("#Slayer").prop("checked",OnorOff);
			$("#Farming").prop("checked",OnorOff);
			$("#Construction").prop("checked",OnorOff);
			$("#Hunter").prop("checked",OnorOff);
		}
		
		$( "#all" ).click(function() {
				checkAll(true);
		});
		$( "#none" ).click(function() {
				checkAll(false);
		});
		$( "#support" ).click(function() {
				$("#none").click();
				$("#Agility").prop("checked", true);
				$("#Thieving").prop("checked", true);
				$("#Slayer").prop("checked", true);
		});
		$( "#artisan" ).click(function() {
				$("#none").click();
				$("#Smithing").prop("checked", true);
				$("#Cooking").prop("checked", true);
				$("#Construction").prop("checked", true);
				$("#Fletching").prop("checked", true);
				$("#Firemaking").prop("checked", true);
				$("#Herblore").prop("checked", true);
				$("#Crafting").prop("checked", true);
				$("#Runecraft").prop("checked", true);
		});
		$( "#gathering" ).click(function() {
				$("#none").click();
				$("#Woodcutting").prop("checked", true);
				$("#Mining").prop("checked", true);
				$("#Fishing").prop("checked", true);
				$("#Hunter").prop("checked", true);
				$("#Farming").prop("checked", true);
		});
		$( "#combat" ).click(function() {
				$("#none").click();
				$("#Attack").prop("checked", true);
				$("#Strength").prop("checked", true);
				$("#Defence").prop("checked", true);
				$("#Magic").prop("checked", true);
				$("#Prayer").prop("checked", true);
				$("#Hitpoints").prop("checked", true);
				$("#Ranged").prop("checked", true);
		});
				

	</script>
  </body>
</html>